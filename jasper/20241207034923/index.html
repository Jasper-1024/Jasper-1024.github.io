<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="M2t8cZr5nIzHmltyt7Utj3nWYxNyNkCzFyigXBHkGUs"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"jasper1024.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.27.0","exturl":true,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"vs2015","dark":"vs2015"},"prism":{"light":"prism-vsc-dark-plus","dark":"prism-vsc-dark-plus"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":{"disqus":{"text":"disqus","order":-1},"utterances":{"text":"utterances","order":-2}},"activeClass":"disqus"},"stickytabs":true,"motion":{"enable":true,"async":true,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/config.min.js" defer></script><meta name="description" content="xdp 的军火库 -&gt; xdp-tools   资料来源:  &lt;&gt;    更新 12024.12.07 初始"><meta property="og:type" content="article"><meta property="og:title" content="XDP-0-xdp-tools"><meta property="og:url" content="https://jasper1024.com/jasper/20241207034923/index.html"><meta property="og:site_name" content="默"><meta property="og:description" content="xdp 的军火库 -&gt; xdp-tools   资料来源:  &lt;&gt;    更新 12024.12.07 初始"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-12-07T12:00:00.000Z"><meta property="article:modified_time" content="2024-12-07T15:51:12.000Z"><meta property="article:author" content="Jasper"><meta property="article:tag" content="xdp"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://jasper1024.com/jasper/20241207034923/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://jasper1024.com/jasper/20241207034923/","path":"jasper/20241207034923/","title":"XDP-0-xdp-tools"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>XDP-0-xdp-tools | 默</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-207687331-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-207687331-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/analytics/google-analytics.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script><script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.31/dist/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script><script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/comments.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/utils.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/motion.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/sidebar.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/next-boot.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/pjax.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.5.0/dist/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/search/local-search.min.js" defer></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/tags/pdf.min.js" defer></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@11.10.1/dist/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/tags/mermaid.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/fancybox.min.js" defer></script><script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"ItayEcWO7OsLFKF2Y8SsAYG1-MdYXbMMI","app_key":"18UBQFmJXXcOQFebLovT36lh","server_url":null,"security":false}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/statistics/lean-analytics.min.js" defer></script><script class="next-config" data-name="enableMath" type="application/json">true</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous"><script src="https://cdn.jsdelivr.net/npm/quicklink@3.0.1/dist/quicklink.umd.js" integrity="sha256-44BednzIpUeQJcY8qtLyarFu0UCCTbgmWOvaoehiFQQ=" crossorigin="anonymous" defer></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://jasper1024.com/jasper/20241207034923/"}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/quicklink.min.js" defer></script><link rel="stylesheet" href="/css/callout_blocks.css"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="alternate" href="/atom.xml" title="默" type="application/rss+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">默</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">生存是唯一的长路</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">46</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">326</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">62</span></a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="fa fa-comments fa-fw"></i>留言</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%BC%E8%AF%AD"><span class="nav-number">1.</span> <span class="nav-text">导语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#libxdp"><span class="nav-number">2.</span> <span class="nav-text">Libxdp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xdp-bench"><span class="nav-number">3.</span> <span class="nav-text">xdp-bench</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mark-stylebackground-ffb86ca6"><span class="nav-number">4.</span> <span class="nav-text">xdp-dump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xdp-filter"><span class="nav-number">5.</span> <span class="nav-text">xdp-filter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xdp-forward"><span class="nav-number">6.</span> <span class="nav-text">xdp-forward</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mark-stylebackground-ffb86ca6-2"><span class="nav-number">7.</span> <span class="nav-text">xdp-loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#load"><span class="nav-number">7.1.</span> <span class="nav-text">Load</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unload"><span class="nav-number">7.2.</span> <span class="nav-text">Unload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#status"><span class="nav-number">7.3.</span> <span class="nav-text">Status</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#features"><span class="nav-number">7.4.</span> <span class="nav-text">Features</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#clean"><span class="nav-number">7.5.</span> <span class="nav-text">Clean</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mark-stylebackground-ffb86ca6-3"><span class="nav-number">8.</span> <span class="nav-text">xdp-monitor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xdp-trafficgen"><span class="nav-number">9.</span> <span class="nav-text">xdp-trafficgen</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%BE%E5%B7%B4"><span class="nav-number">10.</span> <span class="nav-text">尾巴</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Jasper" src="/images/avatar.jfif"><p class="site-author-name" itemprop="name">Jasper</p><div class="site-description" itemprop="description">微尘</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">326</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">46</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">62</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2phc3Blci0xMDI0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jasper-1024"><i class="fab fa-github fa-fw"></i>GitHub</span> </span><span class="links-of-author-item"><a href="/ljy087621@gmail.com" title="E-Mail → ljy087621@gmail.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly94LmNvbS9KYXNwZXJfMTAyNA==" title="Twitter → https:&#x2F;&#x2F;x.com&#x2F;Jasper_1024"><i class="fab fa-twitter fa-fw"></i>Twitter</span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly90Lm1lL2phc3BlcjEwMjQ=" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;jasper1024"><i class="fab fa-skype fa-fw"></i>Telegram</span> </span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml" rel="noopener me"><i class="fas fa-rss fa-fw"></i>RSS</a></span></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmZvcmVjaG8uY29tLw==" title="https:&#x2F;&#x2F;blog.forecho.com&#x2F;">forecho</span></li><li class="links-of-blogroll-item"><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmZvcmVjaG8uY29tL2ZyaWVuZHNoaXAtbGlua3Mv" title="https:&#x2F;&#x2F;blog.forecho.com&#x2F;friendship-links&#x2F;">友链聚合</span></li></ul></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jasper1024.com/jasper/20241207034923/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jfif"><meta itemprop="name" content="Jasper"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="默"><meta itemprop="description" content="微尘"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="XDP-0-xdp-tools | 默"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">XDP-0-xdp-tools</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-12-07 12:00:00 / 修改时间：15:51:12" itemprop="dateCreated datePublished" datetime="2024-12-07T12:00:00Z">2024-12-07</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/ebpf/" itemprop="url" rel="index"><span itemprop="name">ebpf</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/ebpf/xdp/" itemprop="url" rel="index"><span itemprop="name">xdp</span></a> </span></span><span id="/jasper/20241207034923/" class="post-meta-item leancloud_visitors" data-flag-title="XDP-0-xdp-tools" title="阅读次数"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Disqus：</span> <a title="disqus" href="/jasper/20241207034923/#disqus_thread" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="jasper/20241207034923/" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>11k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>10 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><ul><li><p>xdp 的军火库 -&gt; <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scw==">xdp-tools<i class="fa fa-external-link-alt"></i></span></p></li><li><p>资料来源:</p><ul><li>&lt;&gt;</li></ul></li><li><p>更新</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2024.12</span>.<span class="number">07</span> 初始</span><br></pre></td></tr></table></figure></li></ul><span id="more"></span><h2 id="导语"><a class="markdownIt-Anchor" href="#导语"></a> 导语</h2><p>上战场前先看看军火库</p><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scw==">xdp-tools<i class="fa fa-external-link-alt"></i></span> 是一族 xdp 工具集合. 包含 libxdp 和基于 libxdp 的一组工具.</p><ul><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci9saWIvbGlieGRw">libxdp<i class="fa fa-external-link-alt"></i></span> 基于 libbpf 的一系列 xdp 操作封装, 经久耐用.</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtYmVuY2g=">xdp-bench<i class="fa fa-external-link-alt"></i></span></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xdp-project/xdp-tools/tree/master/xdp-dump"><mark style="background:#ffb86CA6">xdp-dump</mark></a>: 与 tcpdump 类似, xdp 的抓包工具;</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtZmlsdGVy">xdp-filter<i class="fa fa-external-link-alt"></i></span>: 基于 xdp 的简单数据过滤器</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtZm9yd2FyZA==">xdp-forward<i class="fa fa-external-link-alt"></i></span>: 指定的网络接口之间加速数据包转发</li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xdp-project/xdp-tools/tree/master/xdp-forward"><mark style="background:#ffb86CA6">xdp-loader</mark></a>: 加载/卸载/查看 xdp 状态等</li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xdp-project/xdp-tools/tree/master/xdp-monitor"><mark style="background:#ffb86CA6">xdp-monitor</mark></a>: 监控统计信息等</li><li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtdHJhZmZpY2dlbg==">xdp-trafficgen<i class="fa fa-external-link-alt"></i></span>: 生成流量工具</li></ul><p>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf search xdp</span></span><br><span class="line"><span class="comment"># 可以看到由 libxdp 和 xdp-tools</span></span><br><span class="line">dnf install libxdp xdp-tools.x86_64</span><br></pre></td></tr></table></figure><p>如果宿主机太老, 建议自行编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/xdp-project/xdp-tools.git</span><br><span class="line"><span class="comment"># 如果本机没有安装 libbpf 或 libbpf 版本太低</span></span><br><span class="line"><span class="comment"># 下载 libbpf 源码,同时编译 libbpf</span></span><br><span class="line">git submodule init &amp;&amp; git submodule update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这一步可能遇到一些包缺失, 逐个解决即可</span></span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="libxdp"><a class="markdownIt-Anchor" href="#libxdp"></a> Libxdp</h2><p>这个后面详细说, 这里暂且不表.</p><h2 id="xdp-bench"><a class="markdownIt-Anchor" href="#xdp-bench"></a> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtYmVuY2g=">xdp-bench<i class="fa fa-external-link-alt"></i></span></h2><p>基准性能测试工具, 这个工具涉及到了一些 bpf 底层内容, 现在暂时还不是太理解.</p><p>#待续</p><h2 id="mark-stylebackground-ffb86ca6"><a class="markdownIt-Anchor" href="#mark-stylebackground-ffb86ca6"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xdp-project/xdp-tools/tree/master/xdp-dump"><mark style="background:#ffb86CA6">xdp-dump</mark></a></h2><p>类似 tcpdump, 捕获 接口 ingress 方向, 即使 xdp 程序返回是 drop 也能捕获;</p><ul><li><mark style="background:#ff5582A6">但是无法捕获 tx 到这个接口的;</mark> 例如 xks 的发包;</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">❯ xdpdump -h</span><br><span class="line"></span><br><span class="line">Usage: xdpdump [options]</span><br><span class="line"></span><br><span class="line"> XDPDump tool to dump network traffic</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">     --rx-capture &lt;mode&gt;          Capture point <span class="keyword">for</span> the rx direction (valid values: entry,<span class="built_in">exit</span>)</span><br><span class="line"> -D, --list-interfaces            Print the list of available interfaces</span><br><span class="line">     --load-xdp-mode &lt;mode&gt;       Mode used <span class="keyword">for</span> --load-xdp-mode, default native (valid values: native,skb,hw,unspecified)</span><br><span class="line">     --load-xdp-program           Load XDP trace program <span class="keyword">if</span> no XDP program is loaded</span><br><span class="line"> -i, --interface &lt;ifname&gt;         Name of interface to capture on</span><br><span class="line">     --perf-wakeup &lt;events&gt;       Wake up xdpdump every &lt;events&gt; packets</span><br><span class="line"> -p, --program-names &lt;prog&gt;       Specific program to attach to</span><br><span class="line"> -P, --promiscuous-mode           Open interface <span class="keyword">in</span> promiscuous mode</span><br><span class="line"> -s, --snapshot-length &lt;snaplen&gt;  Minimum bytes of packet to capture</span><br><span class="line">     --use-pcap                   Use legacy pcap format <span class="keyword">for</span> XDP traces</span><br><span class="line"> -w, --write &lt;file&gt;               Write raw packets to pcap file</span><br><span class="line"> -x, --hex                        Print the full packet <span class="keyword">in</span> hex</span><br><span class="line"> -v, --verbose                    Enable verbose logging (-vv: more verbose)</span><br><span class="line">     --version                    Display version information</span><br><span class="line"> -h, --<span class="built_in">help</span>                       Show this <span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>使用方式也是类似 tcpdump, 示例中给出了一些高频操作的 code;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有接口已加载的 xdp 程序</span></span><br><span class="line"><span class="comment"># 如果没有 xdp 程序生效, +(--load-xdp-program) xdpdump 也能生效, 但是这样情况下直接 tcpdump 不好吗...</span></span><br><span class="line">xdpdump -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># 捕获 ens19 保存到 pcap 文件</span></span><br><span class="line"><span class="built_in">sudo</span> xdpdump -i ens19 -w ens19.pcap</span><br></pre></td></tr></table></figure><p>指定捕获 pkt 的位置: 进入 xdp 程序前 (entry, 默认), 所有 xdp 程序后 (exit);</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定 ens19 挂载点 所有 xdp 程序后 (exit)</span></span><br><span class="line"><span class="comment"># 当 ens19 上已有 xdp 如果给出了 drop, exit 就捕获不到了</span></span><br><span class="line"><span class="built_in">sudo</span> xdpdump -i ens19 --rx-capture=<span class="built_in">exit</span>,<span class="built_in">exit</span> -p xdp_filter</span><br></pre></td></tr></table></figure><p>指定 xdp 程序 一个 or 一组 (逗号隔开)</p><ul><li>程序入口函数名 或 fd</li><li><code>xdpdump -D</code> 可查</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="built_in">sudo</span> xdpdump -i ens19 --rx-capture=entry,<span class="built_in">exit</span> -p xdp_proc1,xdp_proc2 -x</span><br></pre></td></tr></table></figure><p>更详细的参考 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtZHVtcCNleGFtcGxlcw==">官方的示例<i class="fa fa-external-link-alt"></i></span></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xdpdump -D</span></span><br><span class="line">Interface        Prio  Program name      Mode     ID   Tag               Chain actions</span><br><span class="line">--------------------------------------------------------------------------------------</span><br><span class="line">lo                     &lt;No XDP program loaded!&gt;</span><br><span class="line">eth0                   xdp_dispatcher    skb      10558 d51e469e988d81da </span><br><span class="line"> =&gt;              5      xdp_test_prog_w           10576 b5a46c6e9935298c  XDP_PASS</span><br><span class="line"> =&gt;              10     xdp_pass                  10582 3b185187f1855c4c  XDP_PASS</span><br><span class="line"> =&gt;              10     xdp_pass                  10587 3b185187f1855c4c  XDP_PASS</span><br><span class="line"></span><br><span class="line"><span class="comment"># xdpdump -i eth0 --rx-capture=entry,exit -p xdp_dispatcher,xdp_pass@10587</span></span><br><span class="line"><span class="comment"># xdpdump -i eth0 --rx-capture=entry,exit -p 10558,10587</span></span><br><span class="line">listening on eth0, ingress XDP program ID 10558 func xdp_dispatcher, ID 10587 func xdp_pass, capture mode entry/exit, capture size 262144 bytes</span><br><span class="line">1607694215.501287259: xdp_dispatcher()@entry: packet size 102 bytes on if_index 2, rx queue 0, <span class="built_in">id</span> 1</span><br><span class="line">1607694215.501371504: xdp_pass()@entry: packet size 102 bytes on if_index 2, rx queue 0, <span class="built_in">id</span> 1</span><br><span class="line">1607694215.501383099: xdp_pass()@<span class="built_in">exit</span>[PASS]: packet size 102 bytes on if_index 2, rx queue 0, <span class="built_in">id</span> 1</span><br><span class="line">1607694215.501394709: xdp_dispatcher()@<span class="built_in">exit</span>[PASS]: packet size 102 bytes on if_index 2, rx queue 0, <span class="built_in">id</span> 1</span><br><span class="line">^C</span><br><span class="line">4 packets captured</span><br><span class="line">0 packets dropped by perf ring</span><br></pre></td></tr></table></figure><h2 id="xdp-filter"><a class="markdownIt-Anchor" href="#xdp-filter"></a> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtZmlsdGVy">xdp-filter<i class="fa fa-external-link-alt"></i></span></h2><p>l2-l4 基于 xdp 的过滤器, 功能不足,但是性能 ++;</p><p>支持 l2-l4</p><ul><li>mac 地址</li><li>ipv4 ipv6 地址</li><li>tcp / udp 端口</li></ul><p>规则动态添加删除, 无需重启 xdp 程序; 详细配置参考 readme 描述非常清晰;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Usage: xdp-filter COMMAND [options]</span><br><span class="line"></span><br><span class="line">COMMAND can be one of:</span><br><span class="line">       load        - load xdp-filter on an interface</span><br><span class="line">       unload      - unload xdp-filter from an interface</span><br><span class="line">       port        - add a port to the filter list</span><br><span class="line">       ip          - add an IP address to the filter list</span><br><span class="line">       ether       - add an Ethernet MAC address to the filter list</span><br><span class="line">       status      - show current xdp-filter status</span><br><span class="line">       poll        - poll statistics output</span><br><span class="line">       <span class="built_in">help</span>        - show this <span class="built_in">help</span> message</span><br><span class="line"></span><br><span class="line">Use <span class="string">&#x27;xdp-filter COMMAND --help&#x27;</span> to see options <span class="keyword">for</span> each <span class="built_in">command</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载到 eth0 ipv4 过滤</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-filter load eth0 -f ipv4</span><br><span class="line"><span class="comment"># 源是 192.168.1.100 </span></span><br><span class="line"><span class="built_in">sudo</span> xdp-filter ip 192.168.1.100 -m src</span><br><span class="line"><span class="comment"># 查看过滤状态</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-filter status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方例子: 只允许 fc00:dead:cafe::1 的 ipv6 包</span></span><br><span class="line"><span class="comment"># 小心把自己关在外面...</span></span><br><span class="line">xdp-filter load eth0 -f ipv6 -p deny</span><br><span class="line">xdp-filter ip fc00:dead:cafe::1 -m src</span><br></pre></td></tr></table></figure><h2 id="xdp-forward"><a class="markdownIt-Anchor" href="#xdp-forward"></a> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtZm9yd2FyZA==">xdp-forward<i class="fa fa-external-link-alt"></i></span></h2><p>在网卡直接转发 pkt, 在开发中使用很少, 暂时略过.</p><h2 id="mark-stylebackground-ffb86ca6-2"><a class="markdownIt-Anchor" href="#mark-stylebackground-ffb86ca6-2"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xdp-project/xdp-tools/tree/master/xdp-forward"><mark style="background:#ffb86CA6">xdp-loader</mark></a></h2><p>这个敲黑板: <mark style="background:#ff5582A6">重点</mark> 与 xdp 程序加载/卸载有关的一切</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Usage: xdp-loader COMMAND [options]</span><br><span class="line"></span><br><span class="line">COMMAND can be one of:</span><br><span class="line">       load        - load an XDP program on an interface</span><br><span class="line">       unload      - unload an XDP program from an interface</span><br><span class="line">       status      - show current XDP program status</span><br><span class="line">       clean       - clean up detached program links <span class="keyword">in</span> XDP bpffs directory</span><br><span class="line">       features    - show XDP features supported by the NIC</span><br><span class="line">       <span class="built_in">help</span>        - show this <span class="built_in">help</span> message</span><br><span class="line"></span><br><span class="line">Use <span class="string">&#x27;xdp-loader COMMAND --help&#x27;</span> to see options <span class="keyword">for</span> each <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p>可以看到细分下来 xdp-loader 包含了 load unload status clean features 几大部分, 下面分别展开.</p><h3 id="load"><a class="markdownIt-Anchor" href="#load"></a> Load</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Usage: xdp-loader load [options] &lt;ifname&gt; &lt;filenames&gt;</span><br><span class="line"></span><br><span class="line"> Load an XDP program on an interface</span><br><span class="line"></span><br><span class="line">Required parameters:</span><br><span class="line">  &lt;ifname&gt;                        Load on device &lt;ifname&gt;</span><br><span class="line">  &lt;filenames&gt;                     Load programs from &lt;filenames&gt;</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"> -m, --mode &lt;mode&gt;                Load XDP program <span class="keyword">in</span> &lt;mode&gt;; default native (valid values: native,skb,hw,unspecified)</span><br><span class="line"> -p, --pin-path                   Path to pin maps under (must be <span class="keyword">in</span> bpffs).</span><br><span class="line"> -s, --section &lt;section&gt;          ELF section name of program to load (default: first <span class="keyword">in</span> file).</span><br><span class="line"> -n, --prog-name &lt;prog_name&gt;      BPF program name of program to load (default: first <span class="keyword">in</span> file).</span><br><span class="line"> -P, --prio                       Set run priority of program</span><br><span class="line"> -A, --actions &lt;actions&gt;          Chain call actions (default: XDP_PASS). e.g. XDP_PASS,XDP_DROP (valid values: XDP_ABORTED,XDP_DROP,XDP_PASS,XDP_TX,XDP_REDIRECT)</span><br><span class="line"> -v, --verbose                    Enable verbose logging (-vv: more verbose)</span><br><span class="line">     --version                    Display version information</span><br><span class="line"> -h, --<span class="built_in">help</span>                       Show this <span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>主要选项:</p><ul><li>m, <code>--mode &lt;mode&gt;</code>: 指定 XDP 程序加载模式 (native/skb/hw/unspecified)</li><li>p, <code>--pin-path &lt;path&gt;</code>: 指定 map 钉住的根路径</li><li>s, <code>--section &lt;section&gt;</code>: 指定要加载的 ELF section</li><li>n, <code>--prog-name &lt;prog_name&gt;</code>: 指定要加载的程序名称</li><li>P, <code>--prio &lt;priority&gt;</code>: 指定程序优先级</li><li>A, <code>--actions &lt;actions&gt;</code>: 指定链式调用动作<ul><li>这个特殊一点, 当前程序返回什么 xdp action 时候, 才继续执行下一个 xdp 程序.</li><li>取值可以是 XDP_ABORTED,XDP_DROP,XDP_PASS,XDP_TX,XDP_REDIRECT, 默认情况下 当前 xdp 程序返回 XDP_PASS 时才继续执行后面的 xdp 程序</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># eth0 native 模式加载 xdp_drop.o</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader load -m native eth0 xdp_drop.o</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载多个程序,并指定优先级和钉住路径</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader load -P 10 -p /sys/fs/bpf/myapp eth0 prog1.o prog2.o</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 multi_prog.o 的 xdp_prog section</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader load -s xdp_prog eth0 multi_prog.o</span><br></pre></td></tr></table></figure><h3 id="unload"><a class="markdownIt-Anchor" href="#unload"></a> Unload</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Usage: xdp-loader unload [options] &lt;ifname&gt;</span><br><span class="line"></span><br><span class="line"> Unload an XDP program from an interface</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  &lt;ifname&gt;                        Unload from device &lt;ifname&gt;</span><br><span class="line"> -i, --<span class="built_in">id</span> &lt;<span class="built_in">id</span>&gt;                    Unload program with <span class="built_in">id</span> &lt;<span class="built_in">id</span>&gt;</span><br><span class="line"> -a, --all                        Unload all programs from interface</span><br><span class="line"> -v, --verbose                    Enable verbose logging (-vv: more verbose)</span><br><span class="line">     --version                    Display version information</span><br><span class="line"> -h, --<span class="built_in">help</span>                       Show this <span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>参数比较简单了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载 eth1 上所有 xdp 程序</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader unload -a eth1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载 id 为 110 的 xdp 程序</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader unload -i 110 eth1</span><br></pre></td></tr></table></figure><h3 id="status"><a class="markdownIt-Anchor" href="#status"></a> Status</h3><p>最常用命令…确认 xdp 程序 load/unload 是否正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Usage: xdp-loader status [options] [ifname]</span><br><span class="line"></span><br><span class="line"> Show XDP program status</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  [ifname]                        Show status <span class="keyword">for</span> device [ifname] (default all interfaces)</span><br><span class="line"> -v, --verbose                    Enable verbose logging (-vv: more verbose)</span><br><span class="line">     --version                    Display version information</span><br><span class="line"> -h, --<span class="built_in">help</span>                       Show this <span class="built_in">help</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> xdp-loader status</span><br><span class="line"><span class="built_in">sudo</span> xdp-loader status -vv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方示例</span></span><br><span class="line"><span class="comment"># xdp-loader load eth0 xdp_drop.o</span></span><br><span class="line"><span class="comment"># xdp-loader status</span></span><br><span class="line">CURRENT XDP PROGRAM STATUS:</span><br><span class="line"></span><br><span class="line">Interface        Prio  Program name     Mode     ID   Tag               Chain actions</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">lo               &lt;no XDP program&gt;</span><br><span class="line">eth0                   xdp_dispatcher   native   50   d51e469e988d81da</span><br><span class="line"> =&gt;              50    xdp_drop                  55   57cd311f2e27366b  XDP_PASS</span><br></pre></td></tr></table></figure><h3 id="features"><a class="markdownIt-Anchor" href="#features"></a> Features</h3><p>用于确认 interface 对 xdp 的支持程度.</p><ul><li>这里有个坑: rocky8 系列的 4.18 内核反向移植了 xdp, 能够正常支持 xdp 程序, <code>xdp-loader features</code> 无法正常运行.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出更多信息</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader features eth1</span><br><span class="line"><span class="built_in">sudo</span> xdp-loader features -v eth1</span><br><span class="line"><span class="built_in">sudo</span> xdp-loader features -vv eth1</span><br><span class="line"></span><br><span class="line">❯ <span class="built_in">sudo</span> xdp-loader features eth1</span><br><span class="line">NETDEV_XDP_ACT_BASIC:           <span class="built_in">yes</span></span><br><span class="line">NETDEV_XDP_ACT_REDIRECT:        <span class="built_in">yes</span></span><br><span class="line">NETDEV_XDP_ACT_NDO_XMIT:        <span class="built_in">yes</span></span><br><span class="line">NETDEV_XDP_ACT_XSK_ZEROCOPY:    no</span><br><span class="line">NETDEV_XDP_ACT_HW_OFFLOAD:      no</span><br><span class="line">NETDEV_XDP_ACT_RX_SG:           no</span><br><span class="line">NETDEV_XDP_ACT_NDO_XMIT_SG:     no</span><br></pre></td></tr></table></figure><p>详细解释下每个 <code>NETDEV_XDP_ACT_X</code></p><ul><li><code>NETDEV_XDP_ACT_BASIC</code>: 能运行 xdp 程序, 返回 XDP_ACT (XDP_ABORTED, XDP_DROP, XDP_PASS, XDP_TX)</li><li><code>NETDEV_XDP_ACT_REDIRECT</code>: 允许将 pkt 重定向到其他接口/CPU</li><li><code>NETDEV_XDP_ACT_NDO_XMIT</code>: 可以接受 xdp 重定向的 pkt;<ul><li>实现了 ndo_xdp_xmit callback</li></ul></li><li><code>NETDEV_XDP_ACT_XSK_ZEROCOPY</code>: xks 收 pkt 时, 从网卡缓存区到用户应用的 xsk 0 copy;</li><li><code>NETDEV_XDP_ACT_HW_OFFLOAD</code>: 支持硬件卸载模式, 这个非常非常少, 不用太关心;</li><li><code>NETDEV_XDP_ACT_RX_SG</code>: 支持接收非线性 frame<ul><li>一般来说, xdp 处理的 frame 大小是固定的 (默认 4096), 但是 xdp 可以设置 frame 大小非固定, 配合超大 MTU 能够显著减少处理成本.</li><li>但是相对的编程就会麻烦很多, 要额外处理不固定的 frame 大小.</li></ul></li><li><code>NETDEV_XDP_ACT_NDO_XMIT_SG</code>: 支持发送非线性 frame<ul><li>frame 会在下一节解释;</li></ul></li></ul><p>通常前三个为 yes, 说明这个 inerface 可以正常运行 xdp 了;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NETDEV_XDP_ACT_BASIC:           <span class="built_in">yes</span></span><br><span class="line">NETDEV_XDP_ACT_REDIRECT:        <span class="built_in">yes</span></span><br><span class="line">NETDEV_XDP_ACT_NDO_XMIT:        <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p><code>NETDEV_XDP_ACT_XSK_ZEROCOPY: yes</code> 更好, 忘了在哪里看到的资料了, 0copy 与非 0copy 相差 30% 处理性能;</p><p>后面这 3 个不常用到.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NETDEV_XDP_ACT_HW_OFFLOAD:      no</span><br><span class="line">NETDEV_XDP_ACT_RX_SG:           no</span><br><span class="line">NETDEV_XDP_ACT_NDO_XMIT_SG:     no</span><br></pre></td></tr></table></figure><p>wsl2 下各个以太网卡是前 3 个为 yes; tun 网卡也是前 3 个为 yes;</p><h3 id="clean"><a class="markdownIt-Anchor" href="#clean"></a> Clean</h3><p>clean 是清理分离的 xdp 程序链接,例如 接口以及 down 了, 但是 xdp 程序的 map 还 pin 在文件系统;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清理所有接口的分离程序</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader clean</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只清理 eth0 的分离程序</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader clean eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用详细模式清理</span></span><br><span class="line"><span class="built_in">sudo</span> xdp-loader clean -v</span><br></pre></td></tr></table></figure><h2 id="mark-stylebackground-ffb86ca6-3"><a class="markdownIt-Anchor" href="#mark-stylebackground-ffb86ca6-3"></a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xdp-project/xdp-tools/tree/master/xdp-monitor"><mark style="background:#ffb86CA6">xdp-monitor</mark></a></h2><p>实时监控 xdp 程序运行状态, 例如输出 redict 的 pps, drop 的 pps, drop 的原因等等;</p><ul><li>监控的是全部网卡不能指定 interface</li></ul><p>使用非常简单, 没有太多参数.</p><ul><li>i 指定刷新间隔</li><li>s 记录 redirection 成功的包</li><li>e 输出模式设置为拓展模式, 和捕获信息没有关系, 只是输出信息的两种模式, monitor 运行时候可以 <code>Ctrl + \</code> 切换两种输出模式.</li><li>v or vv 打印来自 libxdp 和 libbbpf 的 log 输出</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Usage: xdp-monitor [options]</span><br><span class="line"></span><br><span class="line"> XDP monitor tool, based on tracepoints</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line"> -i, --interval &lt;seconds&gt;         Polling interval (default 2)</span><br><span class="line"> -s, --stats                      Enable statistics <span class="keyword">for</span> transmitted packets (not just errors)</span><br><span class="line"> -e, --extended                   Start running <span class="keyword">in</span> extended output mode (C^\ to toggle)</span><br><span class="line"> -v, --verbose                    Enable verbose logging (-vv: more verbose)</span><br><span class="line">     --version                    Display version information</span><br><span class="line"> -h, --<span class="built_in">help</span>                       Show this <span class="built_in">help</span></span><br></pre></td></tr></table></figure><p>monitor 的输出信息比较繁杂</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跟踪 redirect 的 pkt</span></span><br><span class="line"><span class="comment"># 输出 1s 刷新一次</span></span><br><span class="line">❯ <span class="built_in">sudo</span> xdp-monitor -s -i 1 -v</span><br><span class="line">Current rlimit 1567629312 already &gt;= minimum 1048576</span><br><span class="line">Kernel supports 5-arg xdp_cpumap_kthread tracepoint</span><br><span class="line">Summary                         0 redir/s               0 err,drop/s            0 xmit/s</span><br></pre></td></tr></table></figure><ul><li>rx/s Number of packets received per second</li><li>redir/s	Number of packets successfully redirected per second</li><li>err,drop/s Aggregated count of errors per second (including dropped packets)</li><li>xmit/s	Number of packets transmitted on the output device per second</li></ul><p>现在摁下 <code>ctrl + \</code>, 切换输出信息到 extended 模式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Summary                         0 redir/s               0 err,drop/s            0 xmit/s</span><br><span class="line">  kthread                       0 pkt/s                 0 drop/s                0 <span class="built_in">sched</span></span><br><span class="line">  redirect                      0 redir/s</span><br><span class="line">  redirect_err                  0 error/s</span><br><span class="line">  xdp_exception                 0 hit/s</span><br><span class="line">  devmap_xmit                   0 xmit/s                0 drop/s                0 drv_err/s          0.00 bulk-avg</span><br></pre></td></tr></table></figure><p>但是实际上 extended 模式下太细了, 还是搬上原文的翻译, 可以非常好的排除 xdp 程序问题;</p><ul><li>一般用不到这么详细的信息, 但是一旦一旦涉及到 xdp 程序丢包的排除, 全过程 tcpdump 也找不到具体是哪个程序问题时候…</li><li>xdp-monitor 我的神.</li></ul><table><thead><tr><th>功能</th><th>字段</th><th>描述</th><th>关键指标</th></tr></thead><tbody><tr><td>接收</td><td>receive</td><td>显示接收的数据包数量和遇到的错误</td><td>pkt/s, drop/s, error/s</td></tr><tr><td></td><td>redirect</td><td>显示成功重定向的数据包数量</td><td>redir/s</td></tr><tr><td>重定向</td><td>redirect_err</td><td>显示重定向失败的数据包数量及错误类型</td><td>error/s (EINVAL, ENETDOWN, EMSGSIZE, EOPNOTSUPP, ENOSPC)</td></tr><tr><td></td><td>enqueue to cpu N</td><td>显示入队到特定 CPU 的数据包数量</td><td>pkt/s, drop/s, bulk-avg</td></tr><tr><td>处理</td><td>kthread</td><td>显示 CPUMAP 内核线程处理的数据包数量</td><td>pkt/s, drop/s, sched, pass/s, drop/s, redir/s</td></tr><tr><td>异常</td><td>xdp_exception</td><td>显示 XDP 异常事件</td><td>hit/s</td></tr><tr><td>传输</td><td>devmap_xmit</td><td>显示设备映射传输事件 (仅限非 SKB 模式)</td><td>xmit/s, drop/s, drv_err/s, bulk-avg</td></tr></tbody></table><ul><li>receive(接收):<ul><li>显示接收的数据包数量和遇到的错误</li><li>当发生错误或数据包丢弃时,每个 CPU 的错误和丢包统计将在简洁模式下内联展开<ul><li>pkt/s: 每秒接收的数据包数</li><li>drop/s: 每秒丢弃的数据包数</li><li>error/s: 每秒遇到的错误数</li></ul></li><li>redirect(重定向): 显示成功重定向的数据包数量<ul><li>重定向过程中遇到的错误会在 redirect_err 字段下展开</li><li>注意: 使用 -s 选项启用此功能会带来每个数据包的开销</li><li>redir/s: 每秒成功重定向的数据包数</li></ul></li></ul></li><li>redirect_err(重定向错误):<ul><li>显示重定向失败的数据包数量</li><li>错误代码 (errno) 会在此字段下按每个 CPU 的计数展开</li><li>已识别的错误包括:<ul><li>EINVAL: 无效的重定向</li><li>ENETDOWN: 重定向目标设备已关闭</li><li>EMSGSIZE: 数据包长度对设备来说太大</li><li>EOPNOTSUPP: 不支持的操作</li><li>ENOSPC: cpumap kthread 的 ptr_ring 中没有空间</li></ul></li><li>error/s: 每秒重定向失败的数据包数</li></ul></li><li>enqueue to cpu N(入队到 CPU N):<ul><li>显示入队到 CPU N 的批量队列的数据包数量</li><li>展开为 cpu:FROM-&gt;N 以显示每个 CPU 入队到 CPU N 的统计信息</li><li>接收的数据包可以与重定向程序将数据包入队的 CPU 相关联<ul><li>pkt/s: 每秒从其他 CPU 入队到 CPU N 的数据包数</li><li>drop/s: 尝试入队到 CPU N 时丢弃的数据包数</li><li>bulk-avg: 每个事件处理的平均数据包数</li></ul></li></ul></li><li>kthread(内核线程):<ul><li>显示每个 CPU 的 CPUMAP 内核线程中处理的数据包数量</li><li>展开从 ptr_ring 消耗的数据包数量,以及调用 CPUMAP BPF 程序后的 xdp_stats</li><li>xdp_stats 按总数和每个 CPU 展开,以关联到每个 CPU 的固定 CPUMAP 内核线程<ul><li>pkt/s: 每秒从 ptr_ring 消耗的数据包数</li><li>drop/s: 内核线程中每秒丢弃的数据包数</li><li>sched: 内核线程调用 schedule() 的次数</li></ul></li><li>xdp_stats(也展开到每个 CPU 的计数)<ul><li>pass/s: CPUMAP 程序执行的 XDP_PASS 计数</li><li>drop/s: CPUMAP 程序执行的 XDP_DROP 计数</li><li>redir/s: CPUMAP 程序执行的 XDP_REDIRECT 计数</li></ul></li></ul></li><li>xdp_exception(XDP 异常):<ul><li>显示 xdp_exception 跟踪点事件</li><li>可能由内部驱动程序错误、无法识别的 XDP 操作或用户明确触发 XDP_ABORTED 导致</li><li>每个操作都在此字段下展开其计数<ul><li>hit/s: 每秒触发跟踪点的次数</li></ul></li></ul></li><li>devmap_xmit(设备映射传输):<ul><li>显示 devmap_xmit 跟踪点事件</li><li>此跟踪点用于输出设备上的成功传输,但这些统计信息在通用 XDP 模式下不可用</li><li>使用 SKB 模式时,这些统计将从输出中省略<ul><li>xmit/s: 每秒成功传输的数据包数</li><li>drop/s: 每秒传输失败的数据包数</li><li>drv_err/s: 每秒内部驱动程序错误数</li><li>bulk-avg: 每个事件处理的平均数据包数</li></ul></li></ul></li></ul><h2 id="xdp-trafficgen"><a class="markdownIt-Anchor" href="#xdp-trafficgen"></a> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hkcC1wcm9qZWN0L3hkcC10b29scy90cmVlL21hc3Rlci94ZHAtdHJhZmZpY2dlbg==">xdp-trafficgen<i class="fa fa-external-link-alt"></i></span></h2><p>生成 tcp udp 流量, 生成流量比较单一, 但是性能是相当高…</p><ul><li>UDP : 固定或动态目标端口</li><li>TCP : 单一 TCP 流, 没有拥塞控制, 一旦有丢包就会有大量的重传.</li><li>多线程支持</li><li>目标网卡必须支持 XDP 重定向 (实现 ndo_xdp_xmit 驱动操作).</li></ul><p>对 IP 版本限制:</p><ul><li>udp 写明了只支持 IPv6</li><li>tcp 不明, 没有写不支持 ipv4 , tcp 的一个可选参数 “<code>&lt;hostname&gt;</code>” 只支持 ipv6,但这个参数本身是可选的</li></ul><h2 id="尾巴"><a class="markdownIt-Anchor" href="#尾巴"></a> 尾巴</h2><p>以上大致是整个项目进行中用到的所有工具, 要是没有 xdp-monitor 还不知道能不能完成工作…. 感谢开源社区的工作…</p><p>下一篇是 xdp 和 af_xdp 的理论说明,非常粗略.</p></div><footer class="post-footer"><template id="not-by-ai-badge-template"><li class="post-copyright-not-by-ai"><strong>Not By AI:</strong> <a class="not-by-ai-badge-link" href="https://notbyai.fyi/tw/" target="_blank" rel="noopener noreferrer" title="Not By AI"><img class="not-by-ai-badge not-by-ai-badge--light" src="/images/not-by-ai-written-black-tw.svg" alt="Written By Human, Not By AI"> <img class="not-by-ai-badge not-by-ai-badge--dark" src="/images/not-by-ai-written-white-tw.svg" alt="Written By Human, Not By AI"></a></li></template><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Jasper</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://jasper1024.com/jasper/20241207034923/" title="XDP-0-xdp-tools">https://jasper1024.com/jasper/20241207034923/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><div class="post-tags"><a href="/tags/xdp/" rel="tag"># xdp</a></div><div class="post-nav"><div class="post-nav-item"><a href="/jasper/20241207101651/" rel="prev" title="xdp &amp; af_xdp"><i class="fa fa-angle-left"></i> xdp & af_xdp</a></div><div class="post-nav-item"><a href="/jasper/20241210103446/" rel="next" title="XDP-1-xdp &amp; af_xdp 速览 &amp; 资料汇总">XDP-1-xdp & af_xdp 速览 & 资料汇总 <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="tabs tabs-comment"><ul class="nav-tabs"><li class="tab"><a href="#comment-utterances">utterances</a></li><li class="tab"><a href="#comment-disqus">disqus</a></li></ul><div class="tab-content"><div class="tab-pane utterances" id="comment-utterances"><div class="comments utterances-container"></div></div><div class="tab-pane disqus" id="comment-disqus"><div class="comments" id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016 – <span itemprop="copyrightYear">2026</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">JasperHale</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">1.2m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">18:54</span></span></div><div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9waXNjZXMv">NexT.Pisces</span> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="reading-progress-bar"></div><span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0phc3Blci0xMDI0" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"jasper1024","count":true,"i18n":{"disqus":"disqus"}}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/comments/disqus.min.js" defer></script><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Jasper-1024/blog_discuss","issue_term":"pathname","theme":"github-dark"}</script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-next@8.27.0/source/js/third-party/comments/utterances.min.js" defer></script><script>!function(){function e(){var e,t=document.getElementById("not-by-ai-badge-template");t&&t.content&&((e=document.querySelector(".post-copyright ul"))&&(e.querySelector(".post-copyright-not-by-ai")||e.appendChild(t.content.cloneNode(!0))))}e(),document.addEventListener("pjax:complete",e)}()</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script></body></html>